{% extends 'main/layout.html' %}

{% block title %}
    <h1>–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ</h1>
{% endblock %}

{% block content %}
<div class="container">
    <h1>–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ</h1>
    <form id="medicalForm" method="post">
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.patient.id_for_label }}">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞:</label>
            {{ form.patient }}
        </div>

        <div class="form-group">
            <label for="{{ form.trial.id_for_label }}">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ:</label>
            <select id="trial" name="trial" >
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ --</option>
                {% for trial in trials %}
                    <option value="{{ trial.trial_id }}" data-med="{{ trial.med }}">{{ trial.trial_name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="id_drug">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç:</label>
            <select id="id_drug" name="drug" required>
                <option value="placebo">–ü–ª–∞—Ü–µ–±–æ</option>
            </select>
        </div>

        <div class="form-group">
            <label for="{{ form.condition_score.id_for_label }}">–û—Ü–µ–Ω–∫–∞ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è:</label>
            {{ form.condition_score }}
        </div>

        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    console.log("‚úÖ JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω!");

    const trialSelect = document.getElementById("trial");
    const drugSelect = document.getElementById("id_drug");

    trialSelect.addEventListener("change", function () {
        console.log("üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è...");

        const selectedOption = trialSelect.options[trialSelect.selectedIndex];
        const med = selectedOption.getAttribute("data-med");

        console.log("‚úÖ –í—ã–±—Ä–∞–Ω –ø—Ä–µ–ø–∞—Ä–∞—Ç:", med);

        // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤
        drugSelect.innerHTML = `<option value="placebo">–ü–ª–∞—Ü–µ–±–æ</option>`;

        if (med && med !== "None") {
            const medOption = document.createElement("option");
            medOption.value = med;
            medOption.textContent = med;
            drugSelect.appendChild(medOption);
        }
    });
});

</script>
{% endblock %}